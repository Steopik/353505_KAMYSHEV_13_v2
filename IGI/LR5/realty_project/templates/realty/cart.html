{% extends "base.html" %}
{% block title %}–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫{% endblock %}

{% block content %}
<article>
    <header>
        <h1>üõí –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫</h1>
    </header>

    {% if cart_items %}
    <!-- –¢–∞–±–ª–∏—Ü–∞ —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –≤ –∫–æ—Ä–∑–∏–Ω–µ -->
    <section class="card">
        <table>
            <caption>–û–±—ä–µ–∫—Ç—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –≤–∞—à–µ–π –∫–æ—Ä–∑–∏–Ω–µ</caption>
            <colgroup>
                <col style="width: 40%;">
                <col style="width: 15%;">
                <col style="width: 15%;">
                <col style="width: 15%;">
                <col style="width: 15%;">
            </colgroup>
            <thead>
                <tr>
                    <th scope="col">–û–±—ä–µ–∫—Ç</th>
                    <th scope="col">–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É</th>
                    <th scope="col">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                    <th scope="col">–°—É–º–º–∞</th>
                    <th scope="col">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for item in cart_items %}
                <tr>
                    <th scope="row">
                        <a href="{% url 'realty:property_detail' item.property.pk %}">
                            {{ item.property.title }}
                        </a><br>
                        <small>{{ item.property.address }}</small>
                    </th>
                    <td>
                        <data value="{{ item.property.price }}">
                            {{ item.property.price|floatformat:0 }} <abbr title="–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —Ä—É–±–ª—å">BYN</abbr>
                        </data>
                    </td>
                    <td>
                        <form method="post" action="{% url 'realty:cart' %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="button" onclick="decreaseQuantity({{ item.property.pk }})">‚ûñ</button>
                            <input type="number" 
                                   id="qty-{{ item.property.pk }}" 
                                   name="quantity" 
                                   value="{{ item.quantity }}" 
                                   min="1" 
                                   max="10" 
                                   style="width: 50px; text-align: center;"
                                   readonly>
                            <button type="button" onclick="increaseQuantity({{ item.property.pk }})">‚ûï</button>
                        </form>
                    </td>
                    <td>
                        <strong>
                            <data value="{{ item.subtotal }}">
                                {{ item.subtotal|floatformat:0 }} <abbr title="–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —Ä—É–±–ª—å">BYN</abbr>
                            </data>
                        </strong>
                    </td>
                    <td>
                        <a href="{% url 'realty:remove_from_cart' item.property.pk %}" 
                           class="btn" 
                           style="background-color: #dc3545;"
                           onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?')">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <th scope="row" colspan="3">–ò—Ç–æ–≥–æ:</th>
                    <td colspan="2">
                        <strong style="font-size: 1.2em;">
                            <data value="{{ total_price }}">
                                {{ total_price|floatformat:0 }} <abbr title="–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —Ä—É–±–ª—å">BYN</abbr>
                            </data>
                        </strong>
                    </td>
                </tr>
                <tr>
                    <th scope="row" colspan="3">–í –¥—Ä—É–≥–∏—Ö –≤–∞–ª—é—Ç–∞—Ö:</th>
                    <td colspan="2">
                        ‚âà {{ total_usd|floatformat:0 }} <abbr title="United States Dollar">USD</abbr><br>
                        ‚âà {{ total_eur|floatformat:0 }} <abbr title="Euro">EUR</abbr>
                    </td>
                </tr>
            </tfoot>
        </table>
    </section>

    <!-- –ü—Ä–æ–º–æ–∫–æ–¥ –∏ –¥–µ–π—Å—Ç–≤–∏—è -->
    <section class="card">
        <h3>–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</h3>
        <form method="post" action="#">
            <fieldset>
                <legend>–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ —Å–∫–∏–¥–∫—É</legend>
                <label for="promo">–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥:</label>
                <input type="text" 
                       id="promo" 
                       name="promo_code" 
                       placeholder="SALE2024"
                       pattern="[A-Z0-9]{4,10}"
                       title="–ü—Ä–æ–º–æ–∫–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 4 –¥–æ 10 —Å–∏–º–≤–æ–ª–æ–≤ (–±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã)">
                <button type="submit" class="btn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </fieldset>
        </form>
    </section>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <nav class="card">
        <h3>–î–µ–π—Å—Ç–≤–∏—è —Å –∫–æ—Ä–∑–∏–Ω–æ–π</h3>
        <a href="{% url 'realty:payment' %}" class="btn" style="background-color: #28a745;">
            üí≥ –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ
        </a>
        <a href="{% url 'realty:property_list' %}" class="btn">
            üè† –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–±–æ—Ä
        </a>
        <button onclick="clearCart()" class="btn" style="background-color: #dc3545;">
            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
        </button>
    </nav>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <details class="card">
        <summary>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∫—É–ø–∫–µ</summary>
        <dl>
            <dt><dfn>–°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã</dfn>:</dt>
            <dd>
                <ul>
                    <li>üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</li>
                    <li>üí∞ –ù–∞–ª–∏—á–Ω—ã–µ –≤ –æ—Ñ–∏—Å–µ</li>
                    <li>üè¶ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥</li>
                    <li>üíé –†–∞—Å—Å—Ä–æ—á–∫–∞ –æ—Ç –±–∞–Ω–∫–∞-–ø–∞—Ä—Ç–Ω–µ—Ä–∞</li>
                </ul>
            </dd>
            
            <dt><dfn>–î–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–¥–µ–ª–∫–∏</dfn>:</dt>
            <dd>
                <ol>
                    <li>–ü–∞—Å–ø–æ—Ä—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</li>
                    <li>–î–æ–≥–æ–≤–æ—Ä –∫—É–ø–ª–∏-–ø—Ä–æ–¥–∞–∂–∏</li>
                    <li>–ê–∫—Ç –ø—Ä–∏–µ–º–∞-–ø–µ—Ä–µ–¥–∞—á–∏</li>
                    <li>–ö–≤–∏—Ç–∞–Ω—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ</li>
                </ol>
            </dd>
            
            <dt><dfn>–°—Ä–æ–∫–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</dfn>:</dt>
            <dd>–û—Ç <time datetime="P3D">3 –¥–Ω–µ–π</time> –¥–æ <time datetime="P14D">2 –Ω–µ–¥–µ–ª—å</time></dd>
        </dl>
    </details>

    {% else %}
    <!-- –ü—É—Å—Ç–∞—è –∫–æ—Ä–∑–∏–Ω–∞ -->
    <section class="card">
        <h2>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h2>
        <p>–í—ã –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É.</p>
        <figure>
            <img src="https://via.placeholder.com/400x300" alt="–ü—É—Å—Ç–∞—è –∫–æ—Ä–∑–∏–Ω–∞" width="400" height="300">
            <figcaption>–ù–∞—á–Ω–∏—Ç–µ –≤—ã–±–∏—Ä–∞—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!</figcaption>
        </figure>
        <nav>
            <a href="{% url 'realty:property_list' %}" class="btn">
                üè† –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞—Ç–∞–ª–æ–≥—É
            </a>
        </nav>
    </section>
    {% endif %}

    <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
    <section class="card">
        <h3>üåü –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Ç–∞–∫–∂–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å</h3>
        <p>–ö–ª–∏–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª–∏—Å—å —ç—Ç–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏, —Ç–∞–∫–∂–µ —Å–º–æ—Ç—Ä–µ–ª–∏:</p>
        <nav>
            <ul>
                <li><a href="{% url 'realty:property_list' %}?type=apartment">–ö–≤–∞—Ä—Ç–∏—Ä—ã –≤ –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞—Ö</a></li>
                <li><a href="{% url 'realty:property_list' %}?type=house">–ó–∞–≥–æ—Ä–æ–¥–Ω—ã–µ –¥–æ–º–∞</a></li>
                <li><a href="{% url 'realty:property_list' %}?type=office">–û—Ñ–∏—Å–Ω—ã–µ –ø–æ–º–µ—â–µ–Ω–∏—è</a></li>
            </ul>
        </nav>
    </section>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º–∏ —è—á–µ–π–∫–∞–º–∏ -->
    <section class="card">
        <h3>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–æ–≤ –ø–æ–∫—É–ø–∫–∏</h3>
        <table>
            <caption>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</caption>
            <thead>
                <tr>
                    <th scope="col">–°–ø–æ—Å–æ–±</th>
                    <th scope="col">–°—Ä–æ–∫</th>
                    <th scope="col">–ü–µ—Ä–≤—ã–π –≤–∑–Ω–æ—Å</th>
                    <th scope="col">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th scope="row">–ü–æ–ª–Ω–∞—è –æ–ø–ª–∞—Ç–∞</th>
                    <td>1-3 –¥–Ω—è</td>
                    <td>100%</td>
                    <td rowspan="2">‚úì –ë—ã—Å—Ç—Ä–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ<br>‚úì –°–∫–∏–¥–∫–∞ 5%</td>
                </tr>
                <tr>
                    <th scope="row">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥</th>
                    <td>3-5 –¥–Ω–µ–π</td>
                    <td>100%</td>
                </tr>
                <tr>
                    <th scope="row">–ò–ø–æ—Ç–µ–∫–∞</th>
                    <td>14-30 –¥–Ω–µ–π</td>
                    <td>–æ—Ç 15%</td>
                    <td>‚úì –†–∞—Å—Å—Ä–æ—á–∫–∞ –¥–æ 20 –ª–µ—Ç<br>‚úì –ù–∞–ª–æ–≥–æ–≤—ã–π –≤—ã—á–µ—Ç</td>
                </tr>
                <tr>
                    <th scope="row">–†–∞—Å—Å—Ä–æ—á–∫–∞ –æ—Ç –∑–∞—Å—Ç—Ä–æ–π—â–∏–∫–∞</th>
                    <td colspan="2">7-14 –¥–Ω–µ–π / –æ—Ç 30%</td>
                    <td>‚úì –ë–µ–∑ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤<br>‚úì –î–æ 5 –ª–µ—Ç</td>
                </tr>
            </tbody>
        </table>
    </section>
</article>

<script>
function increaseQuantity(propertyId) {
    const input = document.getElementById('qty-' + propertyId);
    if (input.value < 10) {
        input.value = parseInt(input.value) + 1;
        updateCart(propertyId, input.value);
    }
}

function decreaseQuantity(propertyId) {
    const input = document.getElementById('qty-' + propertyId);
    if (input.value > 1) {
        input.value = parseInt(input.value) - 1;
        updateCart(propertyId, input.value);
    }
}

function updateCart(propertyId, quantity) {
    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã
    console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ ' + propertyId + ': ' + quantity);
}

function clearCart() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É?')) {
        window.location.href = '{% url "realty:clear_cart" %}';
    }
}
</script>

{% endblock %}