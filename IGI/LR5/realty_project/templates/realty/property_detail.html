{% extends "base.html" %}
{% block title %}{{ property.title }}{% endblock %}
{% block og_title %}{{ property.title }} - {{ property.price|floatformat:0 }} BYN{% endblock %}
{% block og_description %}{{ property.description|truncatewords:20 }}{% endblock %}

{% block content %}
<!-- –ú–∏–∫—Ä–æ—Ä–∞–∑–º–µ—Ç–∫–∞ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞ -->
<article itemscope itemtype="http://schema.org/Product">
    <header>
        <h1 itemprop="name">{{ property.title }}</h1>
    </header>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ -->
    <nav class="card">
        <h3 style="color: #333;">–ë—ã—Å—Ç—Ä–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è</h3>
        <ul style="list-style: none; padding: 0;">
            <li><a href="#description" style="color: #007bff; text-decoration: none;">üìù –û–ø–∏—Å–∞–Ω–∏–µ</a></li>
            <li><a href="#specs" style="color: #007bff; text-decoration: none;">üìä –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</a></li>
            <li><a href="#price" style="color: #007bff; text-decoration: none;">üí∞ –¶–µ–Ω–∞</a></li>
            <li><a href="#contacts" style="color: #007bff; text-decoration: none;">üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
            <li><a href="#similar" style="color: #007bff; text-decoration: none;">üè† –ü–æ—Ö–æ–∂–∏–µ –æ–±—ä–µ–∫—Ç—ã</a></li>
        </ul>
    </nav>

    <div class="grid">
        <section class="card" id="specs">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ</h2>
            <dl>
                <dt><dfn>–¢–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</dfn>:</dt>
                <dd itemprop="category">{{ property.get_property_type_display }}</dd>
                
                <dt>–ê–¥—Ä–µ—Å:</dt>
                <dd><address itemprop="address">{{ property.address }}</address></dd>
                
                <dt>–ü–ª–æ—â–∞–¥—å:</dt>
                <dd>{{ property.area }} <abbr title="–∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö –º–µ—Ç—Ä–æ–≤">–º¬≤</abbr></dd>
                
                <dt>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç:</dt>
                <dd><data value="{{ property.rooms_count }}">{{ property.rooms_count|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</data></dd>
                
                <dt>–≠—Ç–∞–∂:</dt>
                <dd><data value="{{ property.floor }}">{{ property.floor|default:"‚Äî" }}</data> –∏–∑ <data value="{{ property.floors_total }}">{{ property.floors_total|default:"‚Äî" }}</data></dd>
                
                <dt>–ì–æ–¥ –ø–æ—Å—Ç—Ä–æ–π–∫–∏:</dt>
                <dd><time datetime="{{ property.year_built }}">{{ property.year_built|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</time></dd>
            </dl>

            <p><strong>–°—Ç–∞—Ç—É—Å:</strong>
                {% if property.is_available %}
                    <mark style="background-color: #d4edda; color: green;">‚úì –î–æ—Å—Ç—É–ø–Ω–æ</mark>
                {% else %}
                    <s style="color: red;">‚úó –ü—Ä–æ–¥–∞–Ω–æ</s>
                {% endif %}
            </p>
        </section>

        <section class="card" id="price">
            <h2>–¶–µ–Ω–∞</h2>
            <div itemprop="offers" itemscope itemtype="http://schema.org/Offer">
                <p style="font-size: 24px; font-weight: bold;">
                    <span itemprop="price">{{ property.price|floatformat:0 }}</span> 
                    <span itemprop="priceCurrency">BYN</span>
                </p>
                <p>‚âà <data value="{{ property.price_usd }}">{{ property.price_usd|floatformat:0 }} <abbr title="United States Dollar">USD</abbr></data></p>
                <p>‚âà <data value="{{ property.price_eur }}">{{ property.price_eur|floatformat:0 }} <abbr title="Euro">EUR</abbr></data></p>
                <link itemprop="availability" href="http://schema.org/{% if property.is_available %}InStock{% else %}OutOfStock{% endif %}" />

                {% if property.is_available %}
                    <button onclick="location.href='{% url 'realty:buy_property' property.pk %}'" class="btn" style="background-color: #28a745;">üõí –ö—É–ø–∏—Ç—å</button>
                    <a href="{% url 'realty:add_to_cart' property.pk %}" class="btn" style="background-color: #ffc107;">‚ûï –í –∫–æ—Ä–∑–∏–Ω—É</a>
                {% endif %}
                {% if user.is_authenticated and user == property.owner or user.is_superuser %}
                    <a href="{% url 'realty:property_update' property.pk %}" class="btn">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                    <a href="{% url 'realty:property_delete' property.pk %}" class="btn" style="background-color: #dc3545;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                {% endif %}
            </div>
        </section>
    </div>

    <!-- –û–ø–∏—Å–∞–Ω–∏–µ —Å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–∑–º–µ—Ç–∫–æ–π -->
    <section class="card" id="description">
        <h2>–û–ø–∏—Å–∞–Ω–∏–µ</h2>
        <p itemprop="description">{{ property.description|default:"–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ"|linebreaks }}</p>
        
        <!-- –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ -->
        <details>
            <summary>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</summary>
            <p>–≠—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º <abbr title="–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–æ—Ä–º—ã –∏ –ø—Ä–∞–≤–∏–ª–∞">–°–ù–∏–ü</abbr> –∏ –∏–º–µ–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.</p>
            <p>–≠–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: –∫–ª–∞—Å—Å <kbd>A+</kbd></p>
            <p>–ö–æ–¥ –æ–±—ä–µ–∫—Ç–∞: <code>PROP-{{ property.pk }}-2024</code></p>
        </details>

        {% if property.owner %}
        <p><strong>–í–ª–∞–¥–µ–ª–µ—Ü:</strong> <var>{{ property.owner.email }}</var></p>
        {% endif %}
        
        <!-- –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div id="contacts">
            <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏</h3>
            <address>
                üìß Email: <a href="mailto:info@realty.by?subject=–û–±—ä–µ–∫—Ç {{ property.pk }}">info@realty.by</a><br>
                üìû –¢–µ–ª–µ—Ñ–æ–Ω: <a href="tel:+375291234567">+375 (29) 123-45-67</a><br>
                üí¨ Telegram: <a href="https://t.me/realty_minsk" target="_blank">@realty_minsk</a>
            </address>
        </div>

        {% if property.agent %}
        <div itemscope itemtype="http://schema.org/Person">
            <p><strong>–ê–≥–µ–Ω—Ç:</strong> 
                <span itemprop="name">{{ property.agent.user.first_name }} {{ property.agent.user.last_name }}</span>
                {% if property.agent.phone %}
                    | <a href="tel:{{ property.agent.phone }}" itemprop="telephone">{{ property.agent.phone }}</a>
                {% endif %}
            </p>
        </div>
        {% endif %}
    </section>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏ -->
    <section class="card">
        <h3>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
        <table>
            <caption>–ü–æ–¥—Ä–æ–±–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –æ–±—ä–µ–∫—Ç–∞</caption>
            <colgroup>
                <col style="background-color: #f8f9fa;">
                <col>
            </colgroup>
            <thead>
                <tr>
                    <th scope="col">–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
                    <th scope="col">–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th scope="row">–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å</th>
                    <td>{{ property.area }} –º¬≤</td>
                </tr>
                <tr>
                    <th scope="row">–ñ–∏–ª–∞—è –ø–ª–æ—â–∞–¥—å</th>
                    <td>{{ property.area|floatformat:0|add:"-10" }} –º¬≤</td>
                </tr>
                <tr>
                    <th scope="row">–ü–ª–æ—â–∞–¥—å –∫—É—Ö–Ω–∏</th>
                    <td>12 –º¬≤</td>
                </tr>
                <tr>
                    <th scope="row">–í—ã—Å–æ—Ç–∞ –ø–æ—Ç–æ–ª–∫–æ–≤</th>
                    <td>2.7 –º</td>
                </tr>
                <tr>
                    <th scope="row">–ú–∞—Ç–µ—Ä–∏–∞–ª —Å—Ç–µ–Ω</th>
                    <td>–ö–∏—Ä–ø–∏—á</td>
                </tr>
                <tr>
                    <th scope="row">–û—Ç–æ–ø–ª–µ–Ω–∏–µ</th>
                    <td>–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ</td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <th scope="row" colspan="2">–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: <time datetime="{{ property.updated_at|date:'c' }}">{{ property.updated_at|date:"d.m.Y" }}</time></th>
                </tr>
            </tfoot>
        </table>
    </section>

    {% if related_news %}
    <section class="card">
        <h3>–°–≤—è–∑–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏</h3>
        <div class="grid">
            {% for news in related_news %}
            <article>
                <h4><a href="{% url 'realty:news_detail' news.pk %}">{{ news.title }}</a></h4>
                <p>{{ news.brief }}</p>
                <footer>
                    <time datetime="{{ news.published_at|date:'c' }}">{{ news.published_at|date:"d/m/Y" }}</time>
                </footer>
            </article>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {% if similar_properties %}
    <section class="card" id="similar">
        <h3>–ü–æ—Ö–æ–∂–∏–µ –æ–±—ä–µ–∫—Ç—ã</h3>
        <div class="grid">
            {% for prop in similar_properties %}
            <article class="card">
                <h4><a href="{% url 'realty:property_detail' prop.pk %}">{{ prop.title }}</a></h4>
                <p>{{ prop.price|floatformat:0 }} BYN</p>
                <p>{{ prop.area }} –º¬≤</p>
                <p>{{ prop.address }}</p>
            </article>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- –ü—Ä–∏–º–µ—Ä —Å –∫–∞—Ä—Ç–æ–π —á–µ—Ä–µ–∑ iframe -->
    <section class="card">
        <h3>–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç–µ</h3>
        <figure>
            <iframe 
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2350.5419764685!2d27.559039!3d53.904541!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x46dbcfdb31e22b87%3A0x9c4cef5e66c7a8a2!2z0J3QtdC30LDQstC40YHQuNC80L7RgdGC0LgsINCc0LjQvdGB0Lo!5e0!3m2!1sru!2sby!4v1234567890"
                width="100%"
                height="300"
                style="border:0;"
                allowfullscreen=""
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade"
                title="–ö–∞—Ä—Ç–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞">
            </iframe>
            <figcaption>üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: {{ property.address }}</figcaption>
        </figure>
    </section>

    <!-- –§–æ—Ä–º–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ -->
    <section class="card">
        <h3>–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –æ–± –æ–±—ä–µ–∫—Ç–µ</h3>
        <form method="post" action="#">
            <fieldset>
                <legend>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è —Ñ–æ—Ä–º–∞</legend>
                
                <label for="name">–í–∞—à–µ –∏–º—è: <abbr title="–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ">*</abbr></label><br>
                <input type="text" id="name" name="name" required placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤" autocomplete="name"><br><br>
                
                <label for="email">Email: <abbr title="–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ">*</abbr></label><br>
                <input type="email" id="email" name="email" required placeholder="example@mail.ru" autocomplete="email"><br><br>
                
                <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label><br>
                <input type="tel" id="phone" name="phone" pattern="\+375 \((29|25|44|33)\) [0-9]{3}-[0-9]{2}-[0-9]{2}" 
                       placeholder="+375 (29) 123-45-67" autocomplete="tel"><br><br>
                
                <label for="message">–°–æ–æ–±—â–µ–Ω–∏–µ: <abbr title="–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ">*</abbr></label><br>
                <textarea id="message" name="message" rows="4" cols="50" required 
                          placeholder="–í–∞—à –≤–æ–ø—Ä–æ—Å –æ–± –æ–±—ä–µ–∫—Ç–µ..." maxlength="500"></textarea><br><br>
                
                <label for="contact-time">–£–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Å–≤—è–∑–∏:</label><br>
                <input type="time" id="contact-time" name="contact-time" min="09:00" max="18:00"><br><br>
                
                <label for="contact-date">–î–∞—Ç–∞ –∑–≤–æ–Ω–∫–∞:</label><br>
                <input type="date" id="contact-date" name="contact-date" min="{{ 'now'|date:'Y-m-d' }}"><br><br>
                
                <button type="submit" class="btn">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
            </fieldset>
        </form>
    </section>

</article>

{% endblock %}